---
title: "Explore Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,root.dir="/home/claire/Git/PhenoRepo/")
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r packages, message=FALSE, warning=FALSE}
library(tidyverse)
library(corrplot)
library(ggfortify)
library(reshape2)
```


-[Essential paper to read](https://www.nature.com/articles/sdata201828)   
-[Very useful paper about phenocams and chromatic coordinates](https://www.sciencedirect.com/science/article/pii/S2530064417300019)  
-[raw image data if interested](https://data.neonscience.org/data-products/DP1.00033.001)   
-[metadata url](https://daac.ornl.gov/VEGETATION/guides/PhenoCam_V2.html)

```{r data, message=FALSE}
rm(list=ls())

# Claire's Rserver WD
setwd("/home/claire/Git/PhenoRepo/")

site <- "GRSM"
# Individual data is not individual data right now!!! Need to fix asap
ind_data <- read_csv(paste0("data/",site,"/",site,"_individual.csv"))
daily_data <- read_csv(paste0("data/",site,"/",site,"_daily.csv")) %>% 
  filter(image_count>0)
gcc_data <- read_csv(paste0("data/",site,"/",site,"_gccTargets.csv"))

gcol <- 'springgreen4'
rcol <- 'sienna3'
bcol <- 'dodgerblue3'

```

**Individual data -- looking at time series plots of data for individual photos
```{r ind_data}
#names(ind_data)

ind_data_melt <- melt(ind_data,id.vars = 'date',measure.vars = c('g_mean',"r_mean","b_mean"))

ggplot(ind_data_melt,aes(x=date,y=value))+
  geom_point(aes(color=variable),alpha=0.5)+
  facet_wrap(~variable)+
  scale_color_manual(values=c(gcol,rcol,bcol))+
  theme_bw()
```

```{r ind_data2}
# names(ind_data)
ind_data_melt2 <- melt(ind_data,id.vars = 'solar_elev',measure.vars = c('gcc',"rcc"))

ggplot(ind_data_melt2,aes(x=solar_elev,y=value))+
  geom_point(aes(color=variable))+
  geom_smooth(method='lm')+
  facet_wrap(~variable)+
  scale_color_manual(values=c(gcol,rcol))+
  theme_bw()
```

**Daily data -- Looking at time series plots of data for photos aggregated by day**.  
This is a plot of r mean, g mean, and b mean across time     
 -'Mean' explanation: "the mean value (for all images passing the selection criteria) of the mean (by image) red channel DN over the ROI"   
  - DN = digital number   
  - "Thus, each pixel in the image is associated with a digital number (“DN”) triplet, with each element in the triplet corresponding to the intensity of one of the colour layers. Therefore, the second step in the image analysis was to read in the images, and associated mask sequence, and to characterize the frequency distribution of the RGB DN triplets within the ROI. We did this separately for each ROI at each site, to produce the “all-image” data files contained in Data Record 3 (see below)."

```{r explore_ind1}
# names(ind_data)

ggplot(daily_data,aes(x=date)) +
  geom_point(aes(y=r_mean),color="darkred",alpha=0.5)+
  geom_point(aes(y=g_mean),color="darkgreen",alpha=0.5)+
  geom_point(aes(y=b_mean),color='darkblue',alpha=0.5)+
  geom_vline(xintercept = as.Date('2017-01-01'),color='grey50',alpha=0.5)+
  geom_vline(xintercept = as.Date('2018-01-01'),color='grey50',alpha=0.5)+
  geom_vline(xintercept = as.Date('2019-01-01'),color='grey50',alpha=0.5)+
  geom_vline(xintercept = as.Date('2020-01-01'),color='grey50',alpha=0.5)+
  geom_vline(xintercept = as.Date('2021-01-01'),color='grey50',alpha=0.5)+
  theme_classic()
```

- Looks like red peaks around November -- severe drop off right as green peaks, which makes sense. 


```{r explore_ind2}
ggplot(daily_data,aes(x=date))+
  geom_point(aes(y=rcc_90),color=rcol,alpha=0.5)+
  geom_point(aes(y=gcc_90),color=gcol,alpha=0.5)+
  theme_classic()
```

```{r explore_ind3}
ggplot(daily_data,aes(x=gcc_90,y=max_solar_elev))+
  geom_point(aes(color=doy),alpha=0.5)+
  geom_smooth(method='lm')+
  theme_classic()

summary(lm(gcc_90~max_solar_elev+doy,data = daily_data))

```


Correlation plots
```{r corrplots}
names(daily_data)
corr_df <- daily_data %>% 
  select(1,2,6:27)
summary(corr_df)

corrplot(cor(corr_df[,2:ncol(corr_df)]))
```

- Strong negative correlations between green variables and red variables   
- Strong positive correlation with max_solar_elev and green variables   


